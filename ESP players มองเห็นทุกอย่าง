local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- ตั้งค่า ESP
local function createESP(player)
	if player == LocalPlayer then return end
	local character = player.Character
	if not character then return end

	-- ส่วนหัว (Head)
	local head = character:FindFirstChild("Head")
	if not head then return end

	-- สร้าง BillboardGui สำหรับชื่อ + HP
	local billboard = Instance.new("BillboardGui")
	billboard.Name = "ESP_Board"
	billboard.Adornee = head
	billboard.Size = UDim2.new(0,200,0,50)
	billboard.AlwaysOnTop = true
	billboard.Parent = head

	local text = Instance.new("TextLabel")
	text.Parent = billboard
	text.Size = UDim2.new(1,0,1,0)
	text.BackgroundTransparency = 1
	text.TextColor3 = Color3.new(1,0,0)
	text.TextScaled = true
	text.Font = Enum.Font.GothamBold

	-- เส้น Tracer
	local tracer = Drawing.new("Line")
	tracer.Color = Color3.fromRGB(0,255,0)
	tracer.Thickness = 2

	RunService.RenderStepped:Connect(function()
		if character and head and character:FindFirstChild("Humanoid") then
			local humanoid = character.Humanoid
			local hpText = "("..math.floor(humanoid.Health).."/"..math.floor(humanoid.MaxHealth)..")"

			text.Text = player.Name.." "..hpText

			-- Tracer Line
			local root = character:FindFirstChild("HumanoidRootPart")
			if root then
				local screenPos, onScreen = workspace.CurrentCamera:WorldToViewportPoint(root.Position)
				if onScreen then
					tracer.Visible = true
					tracer.From = Vector2.new(workspace.CurrentCamera.ViewportSize.X/2, workspace.CurrentCamera.ViewportSize.Y)
					tracer.To = Vector2.new(screenPos.X, screenPos.Y)
				else
					tracer.Visible = false
				end
			end
		else
			tracer.Visible = false
		end
	end)
end

-- สร้าง ESP เมื่อผู้เล่นเกิดใหม่
for _, player in pairs(Players:GetPlayers()) do
	player.CharacterAdded:Connect(function()
		task.wait(1)
		createESP(player)
	end)
end

Players.PlayerAdded:Connect(function(player)
	player.CharacterAdded:Connect(function()
		task.wait(1)
		createESP(player)
	end)
end)
